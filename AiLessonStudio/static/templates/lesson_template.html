<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ lesson.title }} - AI Lesson Studio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.0.0/dist/mermaid.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Lesson Header -->
        <header class="lesson-header card fade-in">
            <div class="badge badge-primary">{{ lesson.difficulty|title }}</div>
            <h1 class="lesson-title">{{ lesson.title }}</h1>
            <div class="lesson-meta">
                <span class="meta-item">
                    <i class="icon-clock"></i>
                    {{ lesson.estimated_time }} minutes
                </span>
                <span class="meta-item">
                    <i class="icon-calendar"></i>
                    {{ lesson.generated_at|datetime }}
                </span>
                <span class="meta-item">
                    <i class="icon-user"></i>
                    {{ user.name }}
                </span>
            </div>
        </header>

        <!-- Learning Objectives -->
        <section class="section card slide-up">
            <h2 class="section-title">üìã Learning Objectives</h2>
            <div class="objectives-grid">
                {% for objective in lesson.learning_objectives %}
                <div class="objective-item">
                    <div class="objective-checkbox"></div>
                    <span>{{ objective }}</span>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Key Concepts -->
        <section class="section card slide-up">
            <h2 class="section-title">üîë Key Concepts</h2>
            <div class="concepts-grid">
                {% for concept in lesson.key_concepts %}
                <div class="concept-card">
                    <h3>{{ concept.name }}</h3>
                    <p>{{ concept.description }}</p>
                    {% if concept.diagram %}
                    <div class="concept-diagram">
                        {{ concept.diagram|safe }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Lesson Content -->
        <main class="lesson-content">
            {% for section in lesson.content_sections %}
            <section class="section card slide-up" style="animation-delay: {{ loop.index * 0.1 }}s">
                <h2 class="section-title">{{ section.title }}</h2>
                <div class="section-content">
                    {{ section.content|markdown|safe }}

                    {% if section.code_examples %}
                    <div class="code-examples">
                        <h3>üíª Code Examples</h3>
                        {% for example in section.code_examples %}
                        <div class="code-block">
                            <div class="code-header">
                                <span>{{ example.language }}</span>
                                <button class="btn btn-secondary copy-btn"
                                        data-code="{{ example.code|escape }}">
                                    Copy
                                </button>
                            </div>
                            <pre><code class="language-{{ example.language }}">{{ example.code }}</code></pre>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if section.diagrams %}
                    <div class="diagrams">
                        <h3>üñºÔ∏è Diagrams</h3>
                        {% for diagram in section.diagrams %}
                        <div class="diagram-container">
                            {{ diagram|safe }}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </section>
            {% endfor %}
        </main>

        <!-- Practice Section -->
        <section class="section card slide-up">
            <h2 class="section-title">üéØ Practice Exercises</h2>
            <div class="exercises">
                {% for exercise in lesson.practice_exercises %}
                <div class="exercise">
                    <h3>{{ exercise.title }}</h3>
                    <p>{{ exercise.description }}</p>

                    <div class="exercise-steps">
                        {% for step in exercise.steps %}
                        <div class="step">
                            <span class="step-number">{{ loop.index }}</span>
                            <span class="step-text">{{ step }}</span>
                        </div>
                        {% endfor %}
                    </div>

                    <button class="btn btn-primary start-exercise"
                            data-exercise-id="{{ exercise.id }}">
                        Start Exercise
                    </button>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Quiz Section -->
        {% if lesson.quiz_questions %}
        <section class="section card slide-up">
            <h2 class="section-title">üìù Knowledge Check</h2>
            <form id="quiz-form" class="quiz-form">
                {% for question in lesson.quiz_questions %}
                <div class="question">
                    <h3>Question {{ loop.index }}: {{ question.question }}</h3>

                    {% if question.type == 'multiple_choice' %}
                    <div class="options">
                        {% for option in question.options %}
                        <label class="option">
                            <input type="radio"
                                   name="q{{ loop.index0 }}"
                                   value="{{ option.value }}">
                            <span>{{ option.text }}</span>
                        </label>
                        {% endfor %}
                    </div>
                    {% elif question.type == 'true_false' %}
                    <div class="options">
                        <label class="option">
                            <input type="radio"
                                   name="q{{ loop.index0 }}"
                                   value="true">
                            <span>True</span>
                        </label>
                        <label class="option">
                            <input type="radio"
                                   name="q{{ loop.index0 }}"
                                   value="false">
                            <span>False</span>
                        </label>
                    </div>
                    {% endif %}

                    <div class="explanation" style="display: none;">
                        <strong>Explanation:</strong> {{ question.explanation }}
                    </div>
                </div>
                {% endfor %}

                <button type="submit" class="btn btn-primary">
                    Submit Quiz
                </button>
            </form>
        </section>
        {% endif %}

        <!-- Lesson Footer -->
        <footer class="lesson-footer card">
            <div class="progress-summary">
                <h3>Your Progress</h3>
                <div class="progress-container">
                    <div class="progress-bar" style="width: {{ progress.percentage }}%;"></div>
                </div>
                <p>{{ progress.percentage|round(1) }}% Complete</p>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="window.print()">
                    üìÑ Print Lesson
                </button>
                <button class="btn btn-primary" id="next-lesson">
                    Next Lesson ‚Üí
                </button>
            </div>

            <div class="copyright">
                <p>¬© {{ current_year }} AI Lesson Studio. All rights reserved.</p>
                <p>This lesson was generated by AI for educational purposes.</p>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/interactive.js') }}"></script>
    <script>
        // Initialize Mermaid diagrams
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        // Initialize Plotly charts
        {% if lesson.charts %}
        {% for chart in lesson.charts %}
        Plotly.newPlot('chart-{{ loop.index }}', {{ chart.data|tojson|safe }}, {{ chart.layout|tojson|safe }});
        {% endfor %}
        {% endif %}

        // Quiz submission
        document.getElementById('quiz-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            // Submit quiz logic here
        });

        // Copy code functionality
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', function() {
                const code = this.getAttribute('data-code');
                navigator.clipboard.writeText(code).then(() => {
                    this.textContent = 'Copied!';
                    setTimeout(() => {
                        this.textContent = 'Copy';
                    }, 2000);
                });
            });
        });
    </script>
</body>
</html>